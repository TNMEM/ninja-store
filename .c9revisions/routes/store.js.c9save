{"ts":1374450435314,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"exports.theItems;\r\n/*\r\n// our array 'database'\r\nexports.theItems = {\r\n    SKN:{name:'Shuriken', price:100},\r\n    ASK:{name:'Ashiko', price:690},\r\n    CGI:{name:'Chigiriki', price:250},\r\n    NGT:{name:'Naginata', price:900},\r\n    KTN:{name:'Katana', price:1000}\r\n};\r\n*/\r\n\r\n// our mysql database\r\n//require('./xmysql');\r\n\r\n// our sequelize database\r\nrequire('./xsequelize');\r\n\r\n// our mongoose/mongodb database ... fetchItem() gives it a second to settle\r\n//var xmongoose = require('./xmongoose');\r\n\r\n// handler for homepage\r\nexports.home = function(req, res) {\r\n    // if user is not logged in, ask them to login\r\n    if (typeof req.session.username == 'undefined') res.render('home', { title: 'Ninja Store'});\r\n    // if user is logged in already, take them straight to the items list\r\n    else res.redirect('/items');\r\n};\r\n\r\n// handler for form submitted from homepage\r\nexports.home_post_handler = function(req, res) {\r\n    // if the username is not submitted, give it a default of \"Anonymous\"\r\n    var username = req.body.username || 'Anonymous';\r\n    // store the username as a session variable\r\n    req.session.username = username;\r\n    // redirect the user to homepage\r\n    res.redirect('/');\r\n};\r\n\r\n// handler for displaying the items\r\nexports.items = function(req, res) {\r\n    if (typeof xmongoose != 'undefined') xmongoose.fetchItems();\r\n    console.log(exports.theItems);\r\n    // don't let nameless people view the items, redirect them back to the homepage\r\n    if (typeof req.session.username == 'undefined') res.redirect('/');\r\n    else res.render('items', { title: 'Ninja Store - Items', username: req.session.username, items:exports.theItems });\r\n};\r\n\r\n// handler for displaying individual items\r\nexports.item = function(req, res) {\r\n    // don't let nameless people view the items, redirect them back to the homepage\r\n    if (typeof req.session.username == 'undefined') res.redirect('/');\r\n    else {\r\n        var name = exports.theItems[req.params.id].name;\r\n        var price = exports.theItems[req.params.id].price;\r\n        res.render('item', { title: 'Ninja Store - ' + name, username: req.session.username, name:name, price:price });\r\n    }\r\n};\r\n\r\n// handler for showing simple pages\r\nexports.page = function(req, res) {\r\n    var name = req.query.name;\r\n    var contents = {\r\n        about: 'Ninja Store sells the coolest ninja stuff in the world. Anyone shopping here is cool.',\r\n        contact: 'You can contact us at <address><strong>Ninja Store</strong>,<br>1, World Ninja Headquarters,<br>Ninja Avenue,<br>NIN80B7-JP,<br>Nihongo.</address>'\r\n    };\r\n    res.render('page', { title: 'Ninja Store - ' + name, username: req.session.username, content:contents[name] });\r\n};"]],"start1":0,"start2":0,"length1":0,"length2":2695}]],"length":2695}
